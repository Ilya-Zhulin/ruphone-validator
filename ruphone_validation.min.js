/*
		Copyright (C) 2020 - 2022 Ilya A.Zhulin. All Rights Reserved.

*/
'use strict';document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("input[type='tel'], input[data-type='tel']").forEach(l=>{l.addEventListener("input",function(p){let r="1234567890+*!".split(""),t="force"===l.getAttribute("data-rutel")?1:0,g=p.target.selectionStart,f=0,m=0,k=l.value,a=[],c=0,q,d="__ (___) ___-__-__".split(""),e="__ (____) __-__-__".split(""),u="_ (___) ___-__-__".split(""),v="_ (____) __-__-__".split(""),b=[];f=g;k="deleteContentBackward"===p.inputType?k.slice(0,
g)+"*"+k.slice(g):k.slice(0,g)+"!"+k.slice(g);a=k.split("");a.forEach((h,n)=>{if(-1===r.indexOf(h)||0<n&&"+"==h)a[n]="",f=g>=n?g-1:g});"8"==a[0]?0===t?b=a[3]&&"9"==a[3]?u:v:(a.shift(),a.unshift("+","7"),b=d):(console.log("arr="+a),"+"==a[0]?("7"==a[1]?b=d:(a.shift(),a.unshift("+","7")),""==a[2]?""==a[3]?(console.log("arr[4]="+a[4]),b="9"==a[4]?d:e):b="9"==a[3]?d:e:b=""==a[2]?"9"==a[3]?d:e:"9"==a[2]?d:e):7==a[0]?(a.unshift("+"),b=""==a[2]?"("==a[3]?"9"==a[4]?d:e:"9"==a[3]?d:e:"("==a[2]?"9"==a[3]?d:
e:"9"==a[2]?d:e):(console.log("arr[0]="+a[0]),"*"!=a[0]&&(a.unshift("+","7"),b=""==a[2]?"("==a[3]?"9"==a[4]?d:e:"9"==a[3]?d:e:"("==a[2]?"9"==a[3]?d:e:"9"==a[2]?d:e)));q=b.length;a.forEach((h,n)=>{if(c<q&&""!=h){for(;"_"!=b[c];)if(c++,0<m||f===c)f++,m++;if("*"==h){if("-"==b[c]||" "==b[c]||")"==b[c]||"("==b[c])for(;"-"==b[c]||" "==b[c]||")"==b[c]||"("==b[c];)console.log("\u0417\u043d\u0430\u043a: "+b[c]),f=c-1;else b[c]="_",0<m&&(f=c-1);c++}else"!"==h?f=c:(b[c]=h,c++);m=0}});l.value=b.join("");l.setSelectionRange(f,
f)})})});
